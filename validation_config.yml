# my_validations.yml
# A sample configuration for validating your own data with DataPact.

validations:
  # This task validates a dimension table.
  - task_key: "validate_dim_customers"
    source_catalog: "source_db_catalog"
    source_schema: "sales"
    source_table: "customers"
    target_catalog: "main"
    target_schema: "gold_layer"
    target_table: "dim_customers"
    primary_keys: ["customer_id"]
    count_tolerance: 0.0
    pk_row_hash_check: true
    pk_hash_tolerance: 0.01 # Allow for 1% of rows to have hash mismatches.
    agg_validations:
      - column: "lifetime_value"
        validations:
          - { agg: "sum", tolerance: 0.005 } # Tolerate a 0.5% difference in total lifetime value.
    custom_sql_tests:
      - name: "Status Distribution"
        description: "Ensure the source and target have identical status counts"
        sql: |
          SELECT status, COUNT(*) AS record_count
          FROM {{ table_fqn }}
          GROUP BY status

  # This task validates a large fact table where only critical columns are hashed.
  - task_key: "validate_fact_orders"
    source_catalog: "source_db_catalog"
    source_schema: "sales"
    source_table: "orders"
    target_catalog: "main"
    target_schema: "gold_layer"
    target_table: "fact_orders"
    primary_keys: ["order_id"]
    count_tolerance: 0.001 # Tolerate a 0.1% difference in row count.
    pk_row_hash_check: true
    pk_hash_tolerance: 0.0
    hash_columns: ["order_id", "customer_id", "order_date", "total_amount"] # Hash only key columns for performance.
